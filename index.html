<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TikTok Shopç¾å›½ç«™åˆ©æ¶¦è®¡ç®—è¡¨26.1.15ç‰ˆ</title>
    <style>
        :root {
            --primary: #0078d7;
            --primary-light: #eef7ff;
            --success: #28a745;
            --success-light: #e6f9e9;
            --danger: #d93025;
            --danger-light: #fff5f5;
            --text-dark: #2c3e50;
            --border-color: #e0e6ed;
            --card-radius: 8px;
        }

        * {margin: 0;padding: 0;box-sizing: border-box;font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;}
        
        body {
            background-color: #f4f6f8;
            color: var(--text-dark);
            padding: 20px;
            font-size: 14px;
        }

        .container {
            max-width: 1600px; 
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 25px;
            transition: all 0.3s ease;
        }
        .header h1 {
            display: inline-block;
            background: #fff;
            color: var(--primary);
            padding: 15px 40px;
            border-radius: 50px;
            font-size: 24px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            border-top: 4px solid var(--primary);
            margin: 0;
            transition: all 0.3s ease;
        }
        
        /* å¤´éƒ¨å˜çº¢æ ·å¼ */
        .header-danger h1 {
            color: var(--danger) !important;
            border-top-color: var(--danger) !important;
            background: var(--danger-light) !important;
            box-shadow: 0 4px 15px rgba(217, 48, 37, 0.15) !important;
        }

        /* --- ä¸‰æ å¸ƒå±€ --- */
        .layout-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            align-items: stretch;
        }

        @media (max-width: 1200px) { .layout-grid { grid-template-columns: 1fr 1fr; } }
        @media (max-width: 768px) { .layout-grid { grid-template-columns: 1fr; } }

        .column {
            display: flex;
            flex-direction: column;
            gap: 20px;
            height: 100%;
        }

        /* --- å¡ç‰‡é€šç”¨ --- */
        .card {
            background: #fff;
            border-radius: var(--card-radius);
            box-shadow: 0 2px 6px rgba(0,0,0,0.02);
            border: 1px solid var(--border-color); /* é»˜è®¤ç»†è¾¹æ¡† */
            overflow: hidden;
            display: flex;
            flex-direction: column;
            transition: border-color 0.3s ease;
        }

        /* äºæŸæ—¶çš„çº¢è‰²æ ·å¼ (æ™®é€šç»†è¾¹æ¡†) */
        .card-danger {
            border-color: var(--danger) !important;
            border-width: 1px !important;
        }
        
        /* äºæŸæ—¶çš„çº¢è‰²æ ·å¼ (åŠ ç²—è¾¹æ¡† - ç”¨äºåˆ©æ¶¦é¢æ¿ - 3px) */
        .card-danger-thick {
            border-color: var(--danger) !important;
            border-width: 3px !important;
            box-shadow: 0 0 15px rgba(217, 48, 37, 0.15);
        }
        
        .card-danger .card-header, .card-danger-thick .card-header {
            border-left-color: var(--danger) !important;
            color: var(--danger);
            background-color: var(--danger-light);
        }

        /* é’ˆå¯¹æŠ˜å é¢æ¿çš„çº¢è‰²æ ·å¼ */
        .details-danger {
            border-color: var(--danger) !important;
        }
        .details-danger .details-summary {
            color: var(--danger) !important;
            background-color: var(--danger-light) !important;
        }

        .column .card:last-child {
            flex: 1;
        }

        .card-header {
            background: #f8f9fb;
            padding: 12px 15px;
            font-weight: 700;
            font-size: 15px;
            color: #333;
            border-bottom: 1px solid var(--border-color);
            border-left: 4px solid var(--primary);
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-shrink: 0;
            transition: all 0.3s ease;
        }

        .card-body {
            padding: 15px;
            flex: 1;
        }

        /* è¡¨å•è¡Œ */
        .input-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 10px;
            min-height: 32px;
        }
        .input-row label {
            color: #555;
            font-size: 13px;
            flex: 1;
            padding-right: 10px;
        }
        .input-group {
            display: flex;
            align-items: center;
            gap: 5px;
            justify-content: flex-end;
        }

        input[type="number"], select {
            width: 100px;
            height: 32px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            padding: 0 8px;
            text-align: right;
            font-weight: 600;
            color: var(--primary);
            transition: all 0.2s;
            font-size: 13px;
        }
        select { width: 110px; }
        input:focus, select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(0,120,215,0.1);
        }
        input:disabled, select:disabled {
            background-color: #f0f0f0;
            color: #999;
            cursor: not-allowed;
        }

        .sub-text { font-size: 12px; color: var(--primary); opacity: 0.8; font-weight: bold; margin-left: 5px; min-width: 70px; text-align: right;}
        .divider { height: 1px; background: #eee; margin: 12px 0; border: none; }
        
        .result-bar {
            background: var(--primary-light);
            padding: 8px 12px;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 8px;
        }
        .result-bar label { font-size: 12px; color: #444; margin: 0; font-weight: 600; }
        .val-blue { color: var(--primary); font-weight: bold; font-size: 14px; }
        .highlight-green { color: var(--success) !important; font-size: 18px !important; font-weight: 800 !important; }

        .vol-wrapper {
            background: #fffbe6;
            border: 1px dashed #ffd591;
            padding: 8px;
            border-radius: 4px;
            margin-bottom: 12px;
            font-size: 12px;
        }
        .vol-wrapper input { width: 45px; height: 26px; padding: 0 2px; text-align: center; font-size: 12px; }
        #volDivisor { width: 60px !important; }

        .preview-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
            margin-top: 10px;
            border: 1px solid #eee;
        }
        .preview-table th { background: #f8f9fa; color: #666; font-weight: normal; padding: 6px; text-align: center; border-bottom: 1px solid #ddd; }
        .preview-table td { padding: 5px; text-align: center; border-bottom: 1px solid #f0f0f0; color: var(--primary); }
        .preview-table tr:last-child td { border-bottom: none; }
        .preview-table .hl-val { color: var(--success); font-weight: 800; }
        .prof-pos { color: var(--success) !important; font-weight: bold; }
        .prof-neg { color: var(--danger) !important; font-weight: bold; }

        .profit-dashboard {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 15px;
            border: 1px solid transparent; 
        }
        .p-item {
            background: rgba(255,255,255,0.7);
            padding: 10px;
            border-radius: 6px;
            border: 1px solid rgba(0,0,0,0.05);
        }
        .p-row1 { grid-column: span 3; }
        .p-row2 { grid-column: span 2; }
        .p-row3 { grid-column: span 6; border: 2px solid rgba(0,0,0,0.05); background: #fff; }

        .p-label { font-size: 12px; color: #666; display: block; margin-bottom: 4px; font-weight: bold; }
        .p-val { font-size: 20px; font-weight: 800; line-height: 1.2; }
        .p-sub { font-size: 12px; font-weight: bold; opacity: 0.9; }

        .bg-green { background: var(--success-light); border-color: var(--success); }
        .bg-green .card-header { background: #d4edda; color: var(--success); border-left-color: var(--success); }
        .bg-green .p-val, .bg-green .p-sub { color: var(--success) !important; }

        .bg-red { background: var(--danger-light); /* è¾¹æ¡†è‰²ç”± card-danger-thick æ§åˆ¶ */ }
        .bg-red .card-header { background: #f8d7da; color: var(--danger); border-left-color: var(--danger); }
        .bg-red .p-val, .bg-red .p-sub { color: var(--danger) !important; }

        /* æŠ˜å è¯´æ˜æ ·å¼ */
        .details-box {
            grid-column: 1 / -1;
            border: 1px solid var(--primary);
            background: #fff;
            border-radius: var(--card-radius);
            overflow: hidden;
            margin-top: 15px;
            transition: all 0.3s ease;
        }
        .details-summary {
            background: #f0fafe;
            padding: 15px;
            cursor: pointer;
            font-weight: bold;
            color: var(--primary);
            list-style: none;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.3s ease;
        }
        .details-summary::-webkit-details-marker { display: none; }
        .details-summary::after { content: '+'; font-size: 20px; }
        details[open] .details-summary::after { content: '-'; }
        
        .details-content {
            padding: 20px;
            background: #fff;
            line-height: 1.8;
            font-size: 13px;
            color: #444;
            border-top: 1px solid #eee;
            overflow-x: auto;
        }
        .details-content p { margin: 8px 0; }

        /* ä»·å¡è¡¨æ ¼æ ·å¼ */
        .rate-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
            margin-top: 10px;
            min-width: 800px;
        }
        .rate-table th, .rate-table td {
            border: 1px solid #e0e6ed;
            padding: 6px 4px;
            text-align: center;
        }
        .rate-table th {
            background-color: #f4f6f8;
            color: #333;
            font-weight: 600;
        }
        .rate-table tr:nth-child(even) { background-color: #fafbfc; }
        .rate-table tr:hover { background-color: #f1f8ff; }
        .rate-hl { color: var(--primary); font-weight: bold; }

        .hide { display: none !important; }
        
        .btn-box { margin-top: 30px; text-align: center; padding-bottom: 20px;}
        .btn { padding: 10px 25px; border-radius: 30px; border: none; cursor: pointer; font-weight: bold; margin: 0 8px; transition: transform 0.2s; font-size: 14px;}
        .btn-reset { background: #fff; border: 1px solid var(--danger); color: var(--danger); }
        .btn-set-init { background: #fff; border: 1px solid var(--success); color: var(--success); }
        .btn-save { background: var(--primary); color: #fff; }
        .btn:hover { transform: scale(1.05); }
    </style>
</head>
<body>

<div class="container">
    <div class="header" id="mainHeader">
        <h1>TikTok Shopç¾å›½ç«™åˆ©æ¶¦è®¡ç®—è¡¨26.1.15ç‰ˆ</h1>
    </div>

    <div class="layout-grid">
        
        <!-- === ç¬¬ä¸€åˆ—ï¼šä¾›åº”é“¾ä¸ç‰©æµ === -->
        <div class="column">
            <!-- 1. åŸºç¡€ & é‡‡è´­ -->
            <div class="card" id="card-base">
                <div class="card-header">ğŸ› ï¸ åŸºç¡€é…ç½® & é‡‡è´­æˆæœ¬</div>
                <div class="card-body">
                    <div class="input-row">
                        <label>æ±‡ç‡ (1 USD = ? RMB)</label>
                        <input type="number" id="rate" value="7.0" step="0.01">
                    </div>
                    <hr class="divider">
                    <div class="input-row">
                        <label>äº§å“é‡é‡ (g)</label>
                        <input type="number" id="productWeight" value="300" step="0.1">
                    </div>
                    <div class="input-row">
                        <label>æ‹¿è´§ä¸ªæ•°</label>
                        <input type="number" id="buyNum" value="300" step="1">
                    </div>
                    <div class="input-row">
                        <label>æ‹¿è´§å•ä»· (RMB)</label>
                        <div class="input-group">
                            <input type="number" id="buyPrice" value="13.5" step="0.01">
                            <span class="sub-text" id="buyPriceUsd">â‰ˆ 1.93 USD</span>
                        </div>
                    </div>
                    <div class="input-row">
                        <label>å…¶ä»–æ‚è´¹ (RMB)</label>
                        <div class="input-group">
                            <input type="number" id="buyOther" value="0" step="0.01">
                            <span class="sub-text" id="buyOtherUsd">â‰ˆ 0.00 USD</span>
                        </div>
                    </div>
                    <div class="result-bar">
                        <label>âœ… æ‹¿è´§æ€»ä»· (RMB)</label>
                        <div class="input-group">
                            <span id="buyTotal" class="highlight-green">4050.00</span>
                            <span class="sub-text" id="buyTotalUsd">â‰ˆ 578.57 USD</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 2. å¤´ç¨‹ç‰©æµ -->
            <div class="card" id="card-ship">
                <div class="card-header">âœˆï¸ å¤´ç¨‹è¿è¾“è´¹ç”¨</div>
                <div class="card-body">
                    <!-- ç®±è§„è¯•ç®— -->
                    <div class="vol-wrapper">
                        <div style="margin-bottom:4px; font-weight:bold; color:#d93025;">ğŸ“¦ ç®±è§„è¯•ç®— (>20.5kg æ ‡çº¢)</div>
                        <div style="display:flex; align-items:center; justify-content:space-between;">
                            <input type="number" id="boxL" value="55" placeholder="é•¿"> <span style="color:#ccc">Ã—</span>
                            <input type="number" id="boxW" value="50" placeholder="å®½"> <span style="color:#ccc">Ã—</span>
                            <input type="number" id="boxH" value="45" placeholder="é«˜"> <span style="color:#ccc">Ã·</span>
                            <input type="number" id="volDivisor" value="6000" placeholder="æç§¯">
                            <span style="color:#ccc">=</span>
                            <span id="volWeightResult" style="font-weight:bold; color:var(--primary); font-size:18px;">20.63 KG</span>
                        </div>
                    </div>

                    <div class="input-row">
                        <label>è¿è¾“æ–¹å¼</label>
                        <select id="shipType">
                            <option value="air" selected>ç©ºè¿</option>
                            <option value="sea">æµ·è¿</option>
                        </select>
                    </div>
                    <div class="input-row" id="airPriceItem">
                        <label>ç©ºè¿ä»·æ ¼ (RMB/KG)</label>
                        <input type="number" id="airPrice" value="54" step="0.01">
                    </div>
                    <div class="input-row hide" id="seaPriceItem">
                        <label>æµ·è¿ä»·æ ¼ (RMB/KG)</label>
                        <input type="number" id="seaPrice" value="12" step="0.01">
                    </div>
                    <div class="input-row">
                        <label>å•ç®±é‡é‡(KG) / è£…é‡(ä¸ª)</label>
                        <div class="input-group">
                            <input type="number" id="boxWeight" value="16" style="width:50px;">
                            <span style="color:#ccc">/</span>
                            <input type="number" id="boxNum" value="50" style="width:50px;">
                        </div>
                    </div>
                    <div class="input-row">
                        <label>æ€»ç®±æ•° (æ€»é‡:<span id="totalWeight" style="color:var(--primary)">96</span>KG)</label>
                        <input type="number" id="totalBox" value="6">
                    </div>

                    <div class="result-bar">
                        <label>âœ… å¤´ç¨‹æ€»ä»· (RMB)</label>
                        <div class="input-group">
                            <span id="shipTotal" class="highlight-green">5184.00</span>
                            <span class="sub-text" id="shipTotalUsd">â‰ˆ 740.57 USD</span>
                        </div>
                    </div>
                    <div class="result-bar">
                        <label>âœ… å•ä¸ªå¤´ç¨‹ (RMB)</label>
                        <div class="input-group">
                            <span id="shipPerProduct" class="highlight-green">17.28</span>
                            <span class="sub-text" id="shipPerProductUsd">â‰ˆ 2.47 USD</span>
                        </div>
                    </div>

                    <!-- æ‰“åŒ…è´¹ç§»åŠ¨åˆ°æ­¤å¤„ -->
                    <hr class="divider">
                    <div class="input-row">
                        <label>å•ä¸ªæ‰“åŒ…è´¹ (RMB)</label>
                        <div class="input-group">
                            <input type="number" id="packPer" value="0.35" step="0.01">
                            <span class="sub-text" id="packPerUsd">â‰ˆ 0.05 USD</span>
                        </div>
                    </div>
                    <div class="result-bar" style="background:#fff; border:1px dashed #eee;">
                        <label>âœ… æ€»æ‰“åŒ…è´¹: <span id="packTotal" style="color:var(--primary)">105.00</span> <span style="color:var(--primary)">RMB</span></label>
                        <span class="sub-text" id="packTotalUsd">â‰ˆ 15.00 USD</span>
                    </div>

                </div>
            </div>

            <!-- 3. æˆæœ¬æ±‡æ€» -->
            <div class="card" id="card-summary" style="border-color: var(--primary);">
                <!-- æ ‡é¢˜ä¿®æ”¹ -->
                <div class="card-header" style="background:#f0f8ff; color:var(--primary);">ğŸ“Š å›½å†…æˆæœ¬ç»Ÿè®¡ (é‡‡è´­+å¤´ç¨‹+æ‚è´¹ï¼‰</div>
                <div class="card-body">
                    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; text-align:center;">
                        <div>
                            <!-- æ ‡ç­¾ä¿®æ”¹ -->
                            <div style="font-size:12px; color:#666;">æ€»è´¹ç”¨ï¼ˆRMBï¼‰</div>
                            <div id="allTotal" class="highlight-green">9339.00</div>
                            <div class="sub-text" id="allTotalUsd" style="text-align:center;">â‰ˆ 1334.14 USD</div>
                        </div>
                        <div style="border-left:1px solid #eee;">
                            <!-- æ ‡ç­¾ä¿®æ”¹ -->
                            <div style="font-size:12px; color:#666;">å•ä¸ªäº§å“æˆæœ¬ï¼ˆRMBï¼‰</div>
                            <div id="perProductCost" class="highlight-green">31.13</div>
                            <div class="sub-text" id="perProductCostUsd" style="text-align:center;">â‰ˆ 4.45 USD</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- === ç¬¬äºŒåˆ—ï¼šè¿è¥ä¸ä»“å‚¨ === -->
        <div class="column">
            <!-- 4. ä»“åº“ & FBT -->
            <div class="card" id="card-warehouse">
                <div class="card-header">ğŸ­ ä»“åº“ & å°¾ç¨‹ç‰©æµ</div>
                <div class="card-body">
                    <div class="input-row">
                        <label>å‘è´§äº§å“ä¸ªæ•°</label>
                        <div class="input-group">
                            <select id="storageProductNum" style="width:60px;">
                                <option value="1" selected>1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option><option value="8">8</option><option value="9">9</option><option value="10">10</option>
                            </select>
                            <span style="font-size:12px; color:#999;">(æ€»é‡:<span id="sendTotalWeight">300</span>g)</span>
                        </div>
                    </div>
                    <div class="input-row">
                        <label>å‚¨å­˜æ–¹å¼</label>
                        <select id="storageType" style="width:100%;">
                            <option value="local">ç¬¬ä¸‰æ–¹æœ¬åœŸä»“</option>
                            <option value="fbt">FBTä»“</option>
                        </select>
                    </div>

                    <!-- FBT åŒºåŸŸ -->
                    <div id="fbtPolicyItem" class="hide" style="background:#e6f7ff; padding:10px; border-radius:4px; margin-bottom:10px;">
                        <div style="margin-bottom:8px;">
                            <label style="color:#005a9e; font-weight:bold; font-size:12px; display:block; margin-bottom:4px;">FBTæ”¿ç­–</label>
                            <select id="fbtPolicy" style="width:100%; border-color:#0078d7; color:#005a9e;">
                                <option value="standard" selected>é»˜è®¤ï¼šæ— é—¨æ§›å…è¿è´¹</option>
                                <option value="optOut">é€€å‡ºï¼š$30é—¨æ§› (ä½äº$30å®¢ä»˜$5.99)</option>
                            </select>
                        </div>
                        <div class="input-row" id="fbtOnePriceItem">
                            <label>FBTä¸€å£ä»· (USD)</label>
                            <div class="input-group">
                                <span id="fbtOnePrice" class="val-blue" style="font-size:14px; margin-right:5px;">4.60</span>
                                <span class="val-blue" style="font-size:14px;">USD</span>
                                <span class="sub-text" id="fbtOnePriceRmb">â‰ˆ 32.20 RMB</span>
                            </div>
                        </div>
                    </div>
                    <div id="fbtReimburseItem" class="result-bar hide" style="background:#e6f9e9; border:1px solid #28a745;">
                        <label style="color:#155724;">âœ… FBTå®˜æ–¹è¡¥è´´</label>
                        <span id="fbtReimburse" class="highlight-green" style="font-size:15px !important;">0.00 USD</span>
                    </div>

                    <!-- æœ¬åœŸä»“ åŒºåŸŸ -->
                    <div id="localArea">
                        <div class="input-row" id="ttsZoneItem">
                            <label>TTS åˆ†åŒº</label>
                            <select id="ttsZone" style="width:130px;">
                                <option value="avg" selected>ğŸŒå…¨åŒºå¹³å‡</option>
                                <option value="0">Zone 1</option><option value="1">Zone 2</option><option value="2">Zone 3</option><option value="3">Zone 4</option><option value="4">Zone 5</option><option value="5">Zone 6</option><option value="6">Zone 7</option><option value="7">Zone 8</option>
                            </select>
                        </div>
                        <div class="input-row" id="localOutFeeItem">
                            <label>å‡ºåº“è´¹ (USD)</label>
                            <div class="input-group">
                                <input type="number" id="localOutFee" value="0.8" step="0.01">
                                <span class="sub-text" id="localOutFeeRmb">â‰ˆ 5.60 RMB</span>
                            </div>
                        </div>
                        <div class="input-row" id="localAddOutFeeItem">
                            <label>ç»­ä»¶è´¹ (USD)</label>
                            <div class="input-group">
                                <input type="number" id="localAddOutFee" value="0.3" step="0.01">
                                <span class="sub-text" id="localAddOutFeeRmb">â‰ˆ 2.10 RMB</span>
                            </div>
                        </div>
                    </div>

                    <div class="result-bar">
                        <label id="storageFeeLabel">âœ… ä»“åº“è´¹ç”¨ (USD)</label>
                        <div class="input-group">
                            <span id="storagePerProduct" class="val-blue">0.80 USD</span>
                            <span class="sub-text" id="storagePerProductRmb">â‰ˆ 5.60 RMB</span>
                        </div>
                    </div>
                    <div class="result-bar" id="ttsFeeItem">
                        <label>âœ… TTS/å°¾ç¨‹ (USD)</label>
                        <div class="input-group">
                            <span id="ttsFeeUsd" class="val-blue">4.80 USD</span>
                            <span class="sub-text" id="ttsFeeRmb">â‰ˆ 33.60 RMB</span>
                        </div>
                    </div>
                    <div class="result-bar" id="storageTtsTotalItem" style="background:#fff8e8; border:1px solid #ffb300;">
                        <label>âœ… ä»“åº“+TTSåˆè®¡</label>
                        <div class="input-group">
                            <span id="storageTtsTotalUsd" class="highlight-green" style="color:#0078d7 !important; font-size:16px !important;">5.60 USD</span>
                            <span class="sub-text" id="storageTtsTotalRmb" style="color:#0078d7; font-weight:bold; font-size:16px;">â‰ˆ 39.20 RMB</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 5. è¿è´¹è§„åˆ™ & ä½£é‡‘ -->
            <div class="card" id="card-fees">
                <div class="card-header">ğŸ’° è¿è´¹åˆ†æ‹… & å¹³å°ä½£é‡‘</div>
                <div class="card-body">
                    <div class="input-row">
                        <label>è¿è´¹æ‰¿æ‹…æ–¹å¼</label>
                        <select id="postType" style="width:130px;">
                            <option value="merchantFree" selected>å•†å®¶åŒ…é‚®</option>
                            <option value="bothShare">å…±åŒæ‰¿æ‹…</option>
                            <option value="customerAll">å®¢æˆ·å…¨æ‹…</option>
                        </select>
                    </div>

                    <!-- å®¢æˆ·è¿è´¹é˜¶æ¢¯è®¾ç½® -->
                    <div id="customerPostStepBox" class="hide" style="background:#fff8e8; padding:8px; border-radius:4px; margin-bottom:10px; border:1px solid #ffb300;">
                        <div style="font-size:12px; color:#d93025; font-weight:bold; margin-bottom:5px;">å®¢æˆ·è¿è´¹é˜¶æ¢¯ (USD)</div>
                        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:5px;">
                            <div class="input-row" style="margin:0;"><label style="font-size:12px;">0-1ä¸ª:</label><input type="number" id="postStep1" value="1.99" style="width:70px;"></div>
                            <div class="input-row" style="margin:0;"><label style="font-size:12px;">1-2ä¸ª:</label><input type="number" id="postStep2" value="2.99" style="width:70px;"></div>
                            <div class="input-row" style="margin:0;"><label style="font-size:12px;">2-3ä¸ª:</label><input type="number" id="postStep3" value="3.99" style="width:70px;"></div>
                            <div class="input-row" style="margin:0;"><label style="font-size:12px;">3-4ä¸ª:</label><input type="number" id="postStep4" value="4.99" style="width:70px;"></div>
                            <div class="input-row" style="margin:0;"><label style="font-size:12px;">4-5ä¸ª:</label><input type="number" id="postStep5" value="5.99" style="width:70px;"></div>
                            <div class="input-row" style="margin:0;"><label style="font-size:12px;">5-6ä¸ª:</label><input type="number" id="postStep6" value="6.99" style="width:70px;"></div>
                            <div class="input-row" style="margin:0; grid-column:1/-1;"><label style="font-size:12px;">6ä¸ª+:</label><input type="number" id="postStep7" value="7.99" style="width:70px;"></div>
                        </div>
                    </div>

                    <div class="result-bar" id="postTotalItem">
                        <label>âœ… å°¾ç¨‹è¿è´¹æ€»é¢</label>
                        <div class="input-group">
                            <span id="postTotalUsd" class="val-blue">4.80 USD</span>
                            <span class="sub-text" id="postTotalRmb">â‰ˆ 33.60 RMB</span>
                        </div>
                    </div>
                    
                    <div class="input-row" id="merchantPostItem">
                        <label>å•†å®¶æ‰¿æ‹… (USD)</label>
                        <div class="input-group">
                            <span id="merchantPostUsd" class="val-blue" style="font-size:14px; margin-right:5px;">4.80</span>
                            <span class="val-blue" style="font-size:14px;">USD</span>
                            <span class="sub-text" id="merchantPostRmb">â‰ˆ 33.60 RMB</span>
                        </div>
                    </div>
                    <div class="input-row hide" id="customerPostItem">
                        <label>å®¢æˆ·æ‰¿æ‹… (USD)</label>
                        <div class="input-group">
                            <div id="customerPostUsd" style="font-weight:bold; color:var(--danger);">1.99</div>
                            <span class="sub-text" id="customerPostRmb">â‰ˆ 13.93 RMB</span>
                        </div>
                    </div>

                    <hr class="divider">

                    <div class="input-row"><label>è¾¾äººä½£é‡‘ (%)</label><input type="number" id="commissionRate" value="0" step="0.01"></div>
                    <div class="input-row"><label>å¹³å°ä½£é‡‘ (%)</label><input type="number" id="platformRate" value="6" step="0.01"></div>
                    <div class="input-row"><label>è´§æŸ+é€€è´§ (%)</label><input type="number" id="damageRate" value="0" step="0.01"></div>

                    <div class="result-bar" style="background:#fff8e8; border:1px solid #ffb300;">
                        <label>âœ… ä½£é‡‘&è´§æŸåˆè®¡</label>
                        <div class="input-group">
                            <span id="totalCostUsd" class="val-blue">0.00 USD</span>
                            <span class="sub-text">â‰ˆ <span id="totalCostRmb" class="val-blue">0.00 RMB</span></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- === ç¬¬ä¸‰åˆ—ï¼šé”€å”®ä¸åˆ©æ¶¦ === -->
        <div class="column">
            <!-- 6. å®šä»· & ä¼˜æƒ åˆ¸ -->
            <div class="card" id="card-pricing">
                <div class="card-header">ğŸ·ï¸ äº§å“å®šä»· & ä¼˜æƒ åˆ¸</div>
                <div class="card-body">
                    <div class="input-row">
                        <label>äº§å“å®šä»· (USD)</label>
                        <div class="input-group">
                            <input type="number" id="salePrice" value="11.99" step="0.01">
                            <span class="sub-text" id="salePriceRmb">â‰ˆ 69.93 RMB</span>
                        </div>
                    </div>
                    
                    <div style="background:#f8f9fa; padding:8px; border-radius:4px; margin:10px 0;">
                        <div style="font-size:12px; color:var(--primary); margin-bottom:5px; font-weight:bold;">ä¼˜æƒ åˆ¸ç­–ç•¥ (USD)</div>
                        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:5px;">
                            <div class="input-row" style="margin:0;"><label style="font-size:12px;">ä¹°1ä¸ª:</label><input type="number" id="coupon1" value="0" style="width:70px;"></div>
                            <div class="input-row" style="margin:0;"><label style="font-size:12px;">ä¹°2ä¸ª:</label><input type="number" id="coupon2" value="0" style="width:70px;"></div>
                            <div class="input-row" style="margin:0;"><label style="font-size:12px;">ä¹°3ä¸ª:</label><input type="number" id="coupon3" value="0" style="width:70px;"></div>
                            <div class="input-row" style="margin:0;"><label style="font-size:12px;">ä¹°4ä¸ª:</label><input type="number" id="coupon4" value="0" style="width:70px;"></div>
                            <div class="input-row" style="margin:0;"><label style="font-size:12px;">ä¹°5ä¸ª:</label><input type="number" id="coupon5" value="0" style="width:70px;"></div>
                            <div class="input-row" style="margin:0;"><label style="font-size:12px;">ä¹°6ä¸ª:</label><input type="number" id="coupon6" value="0" style="width:70px;"></div>
                        </div>
                    </div>

                    <div style="font-size:12px; font-weight:bold; color:#555; margin-top:10px;">ğŸ“Š å®æ—¶è®¡ç®—é¢„è§ˆ (å«è¿è´¹åˆ†æ‹…)</div>
                    <table class="preview-table">
                        <thead><tr><th>æ•°é‡</th><th>å®šä»·</th><th>åˆ¸</th><th>å®¢ä»˜è¿</th><th>æ”¯ä»˜</th><th>å‡ä»·</th><th>åˆ©æ¶¦</th></tr></thead>
                        <tbody id="previewBody">
                            <tr id="showItem1"><td>1</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td></tr>
                            <tr id="showItem2"><td>2</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td></tr>
                            <tr id="showItem3"><td>3</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td></tr>
                            <tr id="showItem4"><td>4</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td></tr>
                            <tr id="showItem5"><td>5</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td></tr>
                            <tr id="showItem6"><td>6</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td></tr>
                        </tbody>
                    </table>

                    <div class="result-bar" style="margin-top:10px;">
                        <label>âœ… å½“å‰åŒ¹é…ä¼˜æƒ åˆ¸</label>
                        <div class="input-group">
                            <span id="autoCouponText" class="val-blue">0.00 USD</span>
                            <span class="sub-text" id="autoCouponRmb">â‰ˆ 0.00 RMB</span>
                        </div>
                    </div>
                    <div class="result-bar">
                        <label>âœ… å®¢æˆ·æœ€ç»ˆæ”¯ä»˜ (USD)</label>
                        <div class="input-group">
                            <span id="finalPriceText" class="highlight-green">9.99 USD</span>
                            <span class="sub-text" id="finalPriceRmb">â‰ˆ 69.93 RMB</span>
                        </div>
                    </div>
                    <div class="result-bar" style="background:#fff8e8; border:1px solid #ffb300;">
                        <label style="color:#d93025;">âœ… å•å“å®ä»˜å‡ä»· (USD)</label>
                        <div class="input-group">
                            <span id="avgPrice" class="val-blue" style="color:#d93025;">9.99 USD</span>
                            <span class="sub-text" style="color:#d93025;">â‰ˆ <span id="avgPriceRmb">69.93 RMB</span></span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 7. åˆ©æ¶¦å¤§å± -->
            <div class="card profit-dashboard bg-green" id="profitBox">
                <div class="card-header" style="grid-column: 1/-1;">âœ¨ æœ€ç»ˆåˆ©æ¶¦ & ROI</div>
                
                <div class="p-item p-row1">
                    <span class="p-label">æœ€ç»ˆæ€»æˆæœ¬</span>
                    <div class="p-val" id="finalAllCostUsd">9.25 USD</div>
                    <div class="p-sub" id="finalAllCostRmb">â‰ˆ 64.75 RMB</div>
                </div>
                <div class="p-item p-row1">
                    <span class="p-label">å®é™…æ”¶å…¥</span>
                    <div class="p-val" id="actualIncomeUsd">9.99 USD</div>
                    <div class="p-sub" id="actualIncomeRmb">â‰ˆ 69.93 RMB</div>
                </div>

                <div class="p-item p-row2">
                    <span class="p-label">å¹³å°æ‰£é‚®åå›æ¬¾</span>
                    <div class="p-val" id="platformNetIncomeUsd" style="font-size:18px;">0.00 USD</div>
                    <div class="p-sub" id="platformNetIncomeRmb">â‰ˆ 0.00 RMB</div>
                </div>
                <div class="p-item p-row2">
                    <span class="p-label">åˆ©æ¶¦ç‡</span>
                    <div class="p-val" id="profitRate" style="font-size:18px;">7.41 %</div>
                </div>
                <div class="p-item p-row2">
                    <span class="p-label">ROI</span>
                    <div class="p-val" id="breakEvenRoi" style="font-size:18px;">13.50</div>
                </div>

                <div class="p-item p-row3">
                    <span class="p-label">âœ… æœ€ç»ˆåˆ©æ¶¦</span>
                    <div class="p-val" id="finalProfitUsd" style="font-size:36px;">0.74 USD</div>
                    <div class="p-sub" id="finalProfitRmb">â‰ˆ 5.18 RMB</div>
                </div>
            </div>
        </div>
    </div>

    <!-- TTS ä»·å¡ -->
    <details class="details-box" id="details-tts">
        <summary class="details-summary">ğŸšš TTSä»·å¡26.1.15ç‰ˆ</summary>
        <div class="details-content">
            <div style="margin-bottom:10px; font-size:12px; color:#666;">å•ä½ï¼šUSDã€‚ä»¥ä¸‹å±•ç¤ºZone 1-8åŠå…¨åŒºå¹³å‡ä»·ã€‚é‡é‡å‘ä¸Šå–æ•´åŒ¹é…ã€‚</div>
            <div id="ttsTableContainer"></div>
        </div>
    </details>

    <!-- FBT ä»·å¡ -->
    <details class="details-box" id="details-fbt">
        <summary class="details-summary">ğŸ¬ FBTä»·å¡26.1.15ç‰ˆ</summary>
        <div class="details-content">
            <div style="margin-bottom:10px; font-size:12px; color:#666;">å•ä½ï¼šUSDã€‚<b>æ˜¾ç¤ºé‡‘é¢ä¸ºå¯¹åº”æ•°é‡çš„æ€»é…é€è´¹ï¼ˆå•ä»·Ã—æ•°é‡ï¼‰</b>ï¼Œç›´è§‚å±•ç¤ºå¤šä»¶æˆæœ¬ã€‚</div>
            <div id="fbtTableContainer"></div>
        </div>
    </details>

    <!-- å¯æŠ˜å è¯´æ˜ -->
    <details class="details-box" id="details-logic">
        <summary class="details-summary">ğŸ“‹ å®Œæ•´è®¡ç®—é€»è¾‘è¯´æ˜ï¼ˆæœ€ç»ˆç²¾å‡†ç‰ˆï¼‰</summary>
        <div class="details-content">
            <p>â–¶ <strong>TTS/å°¾ç¨‹è¿è´¹ï¼š</strong>å·²å†…ç½®2026æœ€æ–°ä»·å¡ (Zone 1-8)ã€‚å¯é€‰æ‹©ç‰¹å®šåˆ†åŒºæˆ–ç³»ç»Ÿè‡ªåŠ¨è®¡ç®—8ä¸ªåŒºçš„å¹³å‡ä»·ã€‚</p>
            <p>â–¶ <strong>ä¼˜æƒ åˆ¸é€»è¾‘æ›´æ–°ï¼š</strong>è´­ä¹°æ•°é‡è¶…è¿‡6ä¸ªæ—¶ï¼Œç³»ç»Ÿè‡ªåŠ¨æ²¿ç”¨â€œä¹°6ä¸ªâ€çš„ä¼˜æƒ åˆ¸é‡‘é¢ï¼Œä¸å†å½’é›¶ã€‚</p>
            <p>â–¶ <strong>FBTé€€å‡ºæ”¿ç­–ï¼š</strong>å·²å†…ç½®2026æœ€æ–°ä»·å¡ï¼Œé€‰æ‹©"é€€å‡º"æ¨¡å¼ä¸”è®¢å•é‡‘é¢(æ‰£é™¤ä¼˜æƒ åˆ¸å)ï¼œ$30ï¼Œå¼ºåˆ¶å®¢æˆ·æ”¯ä»˜$5.99è¿è´¹ï¼Œå–å®¶è·$0.75/ä»¶è¡¥è´´ã€‚</p>
            <p>â–¶ <strong>åŸºç¡€æ¢ç®—è§„åˆ™ï¼š</strong>æ‰€æœ‰ USD é‡‘é¢ Ã— æ±‡ç‡ = å¯¹åº” RMB é‡‘é¢ | æ‰€æœ‰ RMB é‡‘é¢ Ã· æ±‡ç‡ = å¯¹åº” USD é‡‘é¢</p>
            <p>â–¶ <strong>è´§å€¼è®¡ç®—ï¼š</strong>æ‹¿è´§æ€»ä»· = æ‹¿è´§ä»· Ã— æ‹¿è´§ä¸ªæ•° + å…¶ä»–è´¹ç”¨</p>
            <p>â–¶ <strong>å¤´ç¨‹è¿è´¹è®¡ç®—ï¼š</strong>ç®±å­æ€»é‡é‡ = å•ç®±é‡é‡ Ã— æ€»ç®±æ•° | äº§å“æ€»æ•° = å•ç®±è£…æ•° Ã— æ€»ç®±æ•° | å¤´ç¨‹æ€»ä»· = æ€»é‡é‡ Ã— è¿è¾“å•ä»· | å•ä¸ªå¹³æ‘Šå¤´ç¨‹è´¹ = å¤´ç¨‹æ€»ä»· Ã· äº§å“æ€»æ•°</p>
            <p>â–¶ <strong>æ‰“åŒ…è´¹è®¡ç®—ï¼š</strong>æ€»æ‰“åŒ…è´¹ = å•ä¸ªæ‰“åŒ…è´¹ Ã— äº§å“æ€»æ•°</p>
            <p>â–¶ <strong>æ ¸å¿ƒäº§å“æˆæœ¬ï¼š</strong>æ€»è´¹ç”¨ = æ‹¿è´§æ€»ä»·+å¤´ç¨‹æ€»ä»·+æ€»æ‰“åŒ…è´¹ | å•ä¸ªäº§å“æˆæœ¬ = æ€»è´¹ç”¨ Ã· æ‹¿è´§ä¸ªæ•°</p>
            <p>â–¶ <strong>å®šä»·è®¡ç®—ï¼š</strong>å®¢æˆ·æœ€ç»ˆæ”¯ä»˜æ€»ä»· = (äº§å“å®šä»·Ã—å‘è´§ä¸ªæ•°) - å¯¹åº”æ¡£ä½ä¼˜æƒ åˆ¸æ€»é¢ (æœ€ä½ä¸º0ï¼Œæ— è´Ÿæ•°)ï¼Œã€åŒæ–¹åˆ†æ‹…/å®¢æˆ·å…¨æ‹…æ¨¡å¼å åŠ å®¢æˆ·æ‰¿æ‹…è¿è´¹ã€‘</p>
            <p>â–¶ <strong>å¹³æ‘Šå•ä»·ï¼š</strong>å¹³æ‘Šå•ä¸ªå®é™…æ”¯ä»˜ä»· = å®¢æˆ·æœ€ç»ˆæ”¯ä»˜æ€»ä»· Ã· å‘è´§äº§å“ä¸ªæ•°</p>
            <p>â–¶ <strong>ä»“åº“è´¹è®¡ç®—ï¼š</strong>ç¬¬ä¸‰æ–¹æœ¬åœŸä»“ = å‡ºåº“æ“ä½œè´¹ + ç»­ä»¶å‡ºåº“æ“ä½œè´¹ Ã— (å‘è´§äº§å“ä¸ªæ•°-1) | FBTä»“=FBTä¸€å£ä»·è´¹ç”¨ (ç³»ç»Ÿè‡ªåŠ¨æ ¹æ®å®˜æ–¹è´¹ç‡è¡¨åŒ¹é…)</p>
            <p>â–¶ <strong>è¿è´¹æ‰¿æ‹…æ ¸å¿ƒè§„åˆ™ï¼š</strong>ç¬¬ä¸‰æ–¹æœ¬åœŸä»“-å•†å®¶åŒ…é‚®=å•†å®¶æ‰¿æ‹…å…¨é¢TTS | ç¬¬ä¸‰æ–¹æœ¬åœŸä»“-å®¢æˆ·å…¨æ‹…=å®¢æˆ·æ‰¿æ‹…TTS | FBTä»“-å•†å®¶åŒ…é‚®=å•†å®¶æ‰¿æ‹…å…¨é¢FBT | FBTä»“-å®¢æˆ·å…¨æ‹…=å®¢æˆ·æ‰¿æ‹…FBT</p>
            <p>â–¶ <strong>å®¢æˆ·è¿è´¹é˜¶æ¢¯è§„åˆ™ï¼š</strong>åŒæ–¹åˆ†æ‹…æ¨¡å¼ä¸‹ â†’ 0~1ä¸ª=1.99USD |1~2ä¸ª=2.99USD|2~3ä¸ª=3.99USD|3~4ä¸ª=4.99USD|4~5ä¸ª=5.99USD|5~6ä¸ª=6.99USD|6+ä¸ª=7.99USD å…¨éƒ¨å¯ä¿®æ”¹</p>
            <p>â–¶ <strong>ä½£é‡‘è´§æŸè®¡ç®—ï¼š</strong>è¾¾äººä½£é‡‘/å¹³å°ä½£é‡‘/è´§æŸè´¹ç”¨ = å®¢æˆ·æœ€ç»ˆæ”¯ä»˜æ€»ä»· Ã— å¯¹åº”æ¯”ä¾‹(%)</p>
            <p>â–¶ <strong>æœ€ç»ˆæ€»æˆæœ¬ç²¾å‡†è§„åˆ™ã€1ã€‘ï¼š</strong>ç¬¬ä¸‰æ–¹æœ¬åœŸä»“+å•†å®¶åŒ…é‚® = å•å“æˆæœ¬Ã—å‘è´§æ•°+æœ¬æ¬¡å‘è´§ä»“åº“è´¹ç”¨+TTS+ä½£é‡‘è´§æŸç»¼åˆè´¹ç”¨</p>
            <p>â–¶ <strong>æœ€ç»ˆæ€»æˆæœ¬ç²¾å‡†è§„åˆ™ã€2ã€‘ï¼š</strong>ç¬¬ä¸‰æ–¹æœ¬åœŸä»“+åŒæ–¹åˆ†æ‹… = å•å“æˆæœ¬Ã—å‘è´§æ•°+æœ¬æ¬¡å‘è´§ä»“åº“è´¹ç”¨+TTS+ä½£é‡‘è´§æŸç»¼åˆè´¹ç”¨</p>
            <p>â–¶ <strong>æœ€ç»ˆæ€»æˆæœ¬ç²¾å‡†è§„åˆ™ã€3ã€‘ï¼š</strong>ç¬¬ä¸‰æ–¹æœ¬åœŸä»“+å®¢æˆ·å…¨æ‹… = å•å“æˆæœ¬Ã—å‘è´§æ•°+æœ¬æ¬¡å‘è´§ä»“åº“è´¹ç”¨+ä½£é‡‘è´§æŸç»¼åˆè´¹ç”¨</p>
            <p>â–¶ <strong>æœ€ç»ˆæ€»æˆæœ¬ç²¾å‡†è§„åˆ™ã€4ã€‘ï¼š</strong>FBTä»“+å•†å®¶åŒ…é‚® = å•å“æˆæœ¬Ã—å‘è´§æ•°+FBTè´¹ç”¨+ä½£é‡‘è´§æŸç»¼åˆè´¹ç”¨</p>
            <p>â–¶ <strong>æœ€ç»ˆæ€»æˆæœ¬ç²¾å‡†è§„åˆ™ã€5ã€‘ï¼š</strong>FBTä»“+åŒæ–¹åˆ†æ‹… = å•å“æˆæœ¬Ã—å‘è´§æ•°+FBTè´¹ç”¨+ä½£é‡‘è´§æŸç»¼åˆè´¹ç”¨</p>
            <p>â–¶ <strong>æœ€ç»ˆæ€»æˆæœ¬ç²¾å‡†è§„åˆ™ã€6ã€‘ï¼š</strong>FBTä»“+å®¢æˆ·å…¨æ‹… = å•å“æˆæœ¬Ã—å‘è´§æ•°+ä½£é‡‘è´§æŸç»¼åˆè´¹ç”¨</p>
            <p>â–¶ <strong>å®é™…æ”¶å…¥è®¡ç®—ï¼š</strong>å•†å®¶åŒ…é‚®=å®¢æˆ·æœ€ç»ˆæ”¯ä»˜æ€»ä»· | åŒæ–¹åˆ†æ‹…=å®¢æˆ·æœ€ç»ˆæ”¯ä»˜æ€»ä»· | å®¢æˆ·å…¨æ‹…=å®¢æˆ·æœ€ç»ˆæ”¯ä»˜æ€»ä»·</p>
            <p>â–¶ <strong>åˆ©æ¶¦ç›¸å…³ï¼š</strong>æœ€ç»ˆåˆ©æ¶¦ = å®é™…æ”¶å…¥ - æœ€ç»ˆæ€»æˆæœ¬ | é”€å”®åˆ©æ¶¦ç‡ = (æœ€ç»ˆåˆ©æ¶¦ Ã· æœ€ç»ˆæ”¯ä»˜æ€»ä»·) Ã— 100%</p>
            <p>â–¶ <strong>ä¿æœ¬ROIï¼š</strong>æœ€ç»ˆåˆ©æ¶¦ï¼0 = æœ€ç»ˆæ”¯ä»˜æ€»ä»· Ã· æœ€ç»ˆåˆ©æ¶¦ | æœ€ç»ˆåˆ©æ¶¦â‰¤0 æ˜¾ç¤ºã€æ— æ³•ä¿æœ¬ã€‘</p>
        </div>
    </details>

    <div class="btn-box">
        <button class="btn btn-set-init" id="saveInitBtn">âš™ï¸ ä¿å­˜ä¸ºåˆå§‹æ•°æ®</button>
        <button class="btn btn-reset" id="resetBtn">ğŸ”„ é‡ç½®æ•°æ®</button>
        <button class="btn btn-save" id="saveBtn">ğŸ’¾ ä¿å­˜ HTML</button>
    </div>
</div>

<script>
    // å®šä¹‰ä»·å¡æ•°æ®ä¾›è®¡ç®—å’Œå±•ç¤ºä½¿ç”¨
    const TTS_DATA = [
        { maxLb: 0.25, prices: [3.73, 3.77, 3.79, 3.88, 3.99, 4.07, 4.14, 4.28] }, 
        { maxLb: 0.50, prices: [4.11, 4.17, 4.20, 4.25, 4.35, 4.40, 4.46, 4.58] }, 
        { maxLb: 0.75, prices: [4.51, 4.57, 4.62, 4.68, 4.79, 4.94, 5.05, 5.20] }, 
        { maxLb: 1.00, prices: [5.97, 5.97, 5.97, 5.97, 6.05, 6.23, 6.53, 6.88] }, 
        { maxLb: 2.00, prices: [5.97, 5.97, 5.98, 6.16, 6.46, 7.03, 7.42, 7.97] }, 
        { maxLb: 3.00, prices: [6.03, 6.18, 6.31, 6.59, 7.07, 8.02, 8.24, 8.70] }, 
        { maxLb: 4.00, prices: [6.40, 6.57, 6.76, 7.15, 8.00, 8.51, 8.92, 9.45] }, 
        { maxLb: 5.00, prices: [6.55, 6.73, 6.95, 7.37, 8.14, 8.78, 9.20, 9.80] }, 
        { maxLb: 10.0, prices: [7.11, 7.22, 7.69, 8.33, 9.34, 9.84, 10.82, 11.99] }, 
        { maxLb: 15.0, prices: [8.64, 8.75, 9.26, 9.71, 11.12, 12.50, 14.50, 16.27] }, 
        { maxLb: 20.0, prices: [9.51, 9.77, 10.47, 10.92, 13.08, 14.87, 17.46, 19.83] }
    ];

    const FBT_DATA = [
        { max: 0.25, prices: [4.28, 2.52, 1.91, 1.56] }, { max: 0.50, prices: [4.52, 2.91, 2.36, 1.93] }, 
        { max: 0.75, prices: [4.70, 3.05, 2.61, 2.23] }, { max: 1.00, prices: [5.10, 3.16, 2.78, 2.36] }, 
        { max: 2.00, prices: [5.71, 3.92, 3.14, 2.60] }, { max: 3.00, prices: [6.27, 4.30, 3.25, 3.01] }, 
        { max: 4.00, prices: [6.92, 4.70, 3.91, 3.37] }, { max: 5.00, prices: [7.66, 5.09, 4.54, 4.54] }, 
        { max: 6.00, prices: [8.58, 5.55, 5.35, 5.25] }, { max: 7.00, prices: [8.88, 5.90, 5.70, 5.60] }, 
        { max: 8.00, prices: [9.22, 6.39, 6.09, 6.19] }, { max: 9.00, prices: [9.42, 6.57, 6.37, 6.27] }, 
        { max: 10.00, prices: [9.63, 6.76, 6.56, 6.46] }, { max: 11.00, prices: [10.64, 7.58, 7.38, 7.28] }, 
        { max: 12.00, prices: [10.75, 7.97, 7.77, 7.67] }, { max: 13.00, prices: [10.98, 8.07, 7.87, 7.77] }, 
        { max: 14.00, prices: [11.44, 8.41, 8.21, 8.11] }, { max: 15.00, prices: [11.85, 8.78, 8.58, 8.48] }, 
        { max: 16.00, prices: [12.67, 9.53, 9.33, 9.23] }, { max: 17.00, prices: [12.97, 10.70, 10.50, 10.40] }, 
        { max: 18.00, prices: [13.34, 11.12, 10.92, 10.82] }, { max: 19.00, prices: [13.84, 11.69, 11.49, 11.39] }, 
        { max: 20.00, prices: [14.11, 12.00, 11.80, 11.70] }
    ];

    // åˆå§‹åŒ–é»˜è®¤æ•°æ®å­˜å‚¨
    let appDefaults = {};

    const getVal = (id) => {
        const el = document.getElementById(id);
        if (!el) return 0;
        return parseFloat(el.value || el.innerText) || 0;
    };
    const setTxt = (id, txt) => { const el = document.getElementById(id); if(el) el.innerText = txt; };
    const formatNum = (num) => num.toFixed(2);
    
    // åˆå§‹åŒ–æ¸²æŸ“ä»·å¡è¡¨æ ¼
    function renderRateTables() {
        // TTS è¡¨æ ¼
        let ttsHtml = `<table class="rate-table"><thead><tr><th>é‡é‡(lb)</th><th>é‡é‡(g)</th><th>Zone 1</th><th>Zone 2</th><th>Zone 3</th><th>Zone 4</th><th>Zone 5</th><th>Zone 6</th><th>Zone 7</th><th>Zone 8</th><th>å¹³å‡</th></tr></thead><tbody>`;
        TTS_DATA.forEach(row => {
            const avg = (row.prices.reduce((a,b)=>a+b, 0) / row.prices.length).toFixed(2);
            const g = Math.round(row.maxLb * 453.59237);
            ttsHtml += `<tr><td>â‰¤ ${row.maxLb}</td><td>â‰¤ ${g}</td>`;
            row.prices.forEach(p => ttsHtml += `<td>${p.toFixed(2)}</td>`);
            ttsHtml += `<td class="rate-hl">${avg}</td></tr>`;
        });
        ttsHtml += `</tbody></table>`;
        document.getElementById('ttsTableContainer').innerHTML = ttsHtml;

        // FBT è¡¨æ ¼ - ä¿®æ”¹ä¸ºæ˜¾ç¤ºæ€»è´¹ç”¨ (å•ä»· * æ•°é‡)
        // ä¿®æ­£ï¼šæœ€åä¸€åˆ—æ ‡é¢˜æ”¹ä¸º "â‰¥ 4ä»¶æ€»è´¹"
        let fbtHtml = `<table class="rate-table"><thead><tr><th>é‡é‡(lb)</th><th>é‡é‡(g)</th><th>1ä»¶æ€»è´¹</th><th>2ä»¶æ€»è´¹</th><th>3ä»¶æ€»è´¹</th><th>â‰¥ 4ä»¶æ€»è´¹</th></tr></thead><tbody>`;
        FBT_DATA.forEach(row => {
            const g = Math.round(row.max * 453.59237);
            fbtHtml += `<tr><td>â‰¤ ${row.max}</td><td>â‰¤ ${g}</td>`;
            // 0:Qty1, 1:Qty2, 2:Qty3, 3:Qty4+
            // è®¡ç®—æ€»ä»·ï¼šå•ä»· * æ•°é‡
            fbtHtml += `<td class="rate-hl">${row.prices[0].toFixed(2)}</td>`; // 1ä»¶
            fbtHtml += `<td class="rate-hl">${(row.prices[1] * 2).toFixed(2)}</td>`; // 2ä»¶
            fbtHtml += `<td class="rate-hl">${(row.prices[2] * 3).toFixed(2)}</td>`; // 3ä»¶
            fbtHtml += `<td class="rate-hl">${(row.prices[3] * 4).toFixed(2)}</td>`; // 4ä»¶
            fbtHtml += `</tr>`;
        });
        fbtHtml += `</tbody></table>`;
        document.getElementById('fbtTableContainer').innerHTML = fbtHtml;
    }

    function calcVolWeight() {
        const l = getVal('boxL'), w = getVal('boxW'), h = getVal('boxH'), div = getVal('volDivisor') || 6000;
        const res = (l * w * h) / div;
        const el = document.getElementById('volWeightResult');
        el.innerText = res.toFixed(2) + ' KG';
        el.style.color = res > 20.5 ? '#d93025' : '#0078d7';
    }

    function getTtsFee(weightG, zoneIdx) {
        const lb = weightG / 453.59237; 
        let selectedRow = TTS_DATA.find(r => lb <= r.maxLb) || TTS_DATA[TTS_DATA.length - 1];
        if (zoneIdx === 'avg') return selectedRow.prices.reduce((a, b) => a + b, 0) / selectedRow.prices.length;
        return selectedRow.prices[parseInt(zoneIdx)];
    }

    function getFbtUnitRate(weightG, qty) {
        const lb = weightG / 453.59237;
        let colIdx = qty >= 4 ? 3 : qty - 1;
        let row = FBT_DATA.find(r => lb <= r.max);
        if (row) return row.prices[colIdx];
        // è¶…é‡è¡¥ä¸é€»è¾‘
        if (lb <= 50) return 18.00 + (Math.max(0, Math.ceil(lb - 21)) * 0.40);
        return 41.32 + (Math.max(0, Math.ceil(lb - 50)) * 0.75);
    }

    function getCouponValue(count) { return getVal(count > 6 ? 'coupon6' : 'coupon' + count); }
    function getCustomerPostStep(count) {
        if (count < 1) return getVal('postStep1');
        if (count >= 7) return getVal('postStep7');
        return getVal('postStep' + Math.ceil(count)); 
    }

    document.getElementById('storageType').addEventListener('change', function() {
        const type = this.value;
        const postTypeSelect = document.getElementById('postType');
        if (type === 'local') {
            postTypeSelect.value = 'merchantFree';
            postTypeSelect.disabled = false;
        } else {
            const fbtPolicy = document.getElementById('fbtPolicy');
            fbtPolicy.value = 'standard'; 
            postTypeSelect.value = 'merchantFree';
            postTypeSelect.disabled = false;
        }
        calculate(); 
    });

    document.getElementById('fbtPolicy').addEventListener('change', function() {
        const policy = this.value;
        const postTypeSelect = document.getElementById('postType');
        if (policy === 'standard') {
            postTypeSelect.value = 'merchantFree';
            postTypeSelect.disabled = false;
        } else {
            postTypeSelect.value = 'bothShare';
            postTypeSelect.disabled = true;
        }
        calculate();
    });

    function calculate() {
        const storageType = document.getElementById('storageType').value;
        const fbtPolicy = document.getElementById('fbtPolicy').value;
        const postTypeSelect = document.getElementById('postType');
        
        if (storageType === 'fbt' && fbtPolicy === 'optOut') {
            postTypeSelect.value = 'bothShare'; 
            postTypeSelect.disabled = true;    
        }

        calcVolWeight();

        const rate = getVal('rate');
        const buyTotalRMB = (getVal('buyPrice') * getVal('buyNum')) + getVal('buyOther');
        const buyTotalUSD = buyTotalRMB / rate;
        setTxt('buyPriceUsd', `â‰ˆ ${formatNum(getVal('buyPrice')/rate)} USD`);
        setTxt('buyOtherUsd', `â‰ˆ ${formatNum(getVal('buyOther')/rate)} USD`);
        setTxt('buyTotal', formatNum(buyTotalRMB));
        setTxt('buyTotalUsd', `â‰ˆ ${formatNum(buyTotalUSD)} USD`);

        const shipType = document.getElementById('shipType').value;
        document.getElementById('airPriceItem').classList.toggle('hide', shipType !== 'air');
        document.getElementById('seaPriceItem').classList.toggle('hide', shipType !== 'sea');
        const shipPrice = shipType === 'air' ? getVal('airPrice') : getVal('seaPrice');
        const totalW = getVal('boxWeight') * getVal('totalBox');
        const totalP = getVal('boxNum') * getVal('totalBox');
        const shipTotal = totalW * shipPrice;
        setTxt('totalWeight', totalW); 
        setTxt('shipTotal', formatNum(shipTotal)); setTxt('shipTotalUsd', `â‰ˆ ${formatNum(shipTotal/rate)} USD`);
        setTxt('shipPerProduct', formatNum(shipTotal/totalP)); setTxt('shipPerProductUsd', `â‰ˆ ${formatNum((shipTotal/totalP)/rate)} USD`);

        const packPer = getVal('packPer');
        const packTotal = packPer * getVal('buyNum');
        setTxt('packPerUsd', `â‰ˆ ${formatNum(packPer/rate)} USD`);
        setTxt('packTotal', formatNum(packTotal)); setTxt('packTotalUsd', `â‰ˆ ${formatNum(packTotal/rate)} USD`);
        const allTotal = buyTotalRMB + shipTotal + packTotal;
        const unitCost = allTotal / getVal('buyNum');
        const unitCostUSD = unitCost / rate;
        setTxt('allTotal', formatNum(allTotal)); setTxt('allTotalUsd', `â‰ˆ ${formatNum(allTotal/rate)} USD`);
        setTxt('perProductCost', formatNum(unitCost)); setTxt('perProductCostUsd', `â‰ˆ ${formatNum(unitCostUSD)} USD`);

        const saleQty = parseInt(document.getElementById('storageProductNum').value);
        const sendWeight = getVal('productWeight') * saleQty;
        setTxt('sendTotalWeight', sendWeight);
        
        const isFbt = storageType === 'fbt';
        document.getElementById('fbtPolicyItem').classList.toggle('hide', !isFbt);
        document.getElementById('localArea').classList.toggle('hide', isFbt);
        
        let whFeeUSD = 0, ttsUSD = 0;
        if (isFbt) {
            const fbtRate = getFbtUnitRate(getVal('productWeight'), saleQty);
            const fbtTotal = fbtRate * saleQty;
            document.getElementById('fbtOnePrice').innerText = fbtTotal.toFixed(2);
            setTxt('fbtOnePriceRmb', `â‰ˆ ${formatNum(fbtTotal*rate)} RMB`);
            whFeeUSD = fbtTotal;
        } else {
            whFeeUSD = getVal('localOutFee') + (Math.max(0, saleQty-1) * getVal('localAddOutFee'));
            ttsUSD = getTtsFee(sendWeight, document.getElementById('ttsZone').value);
        }
        setTxt('localOutFeeRmb', `â‰ˆ ${formatNum(getVal('localOutFee')*rate)} RMB`);
        setTxt('localAddOutFeeRmb', `â‰ˆ ${formatNum(getVal('localAddOutFee')*rate)} RMB`);
        setTxt('storagePerProduct', `${formatNum(whFeeUSD)} USD`); setTxt('storagePerProductRmb', `â‰ˆ ${formatNum(whFeeUSD*rate)} RMB`);
        
        document.getElementById('ttsFeeItem').classList.toggle('hide', isFbt); 
        setTxt('ttsFeeUsd', `${formatNum(ttsUSD)} USD`); setTxt('ttsFeeRmb', `â‰ˆ ${formatNum(ttsUSD*rate)} RMB`); 
        
        const stTtsTotal = whFeeUSD + ttsUSD;
        setTxt('storageTtsTotalUsd', `${formatNum(stTtsTotal)} USD`); 
        setTxt('storageTtsTotalRmb', `â‰ˆ ${formatNum(stTtsTotal*rate)} RMB`); 
        document.getElementById('storageTtsTotalItem').classList.toggle('hide', isFbt); 

        const elFbt = document.getElementById('storagePerProduct').parentNode;
        if(isFbt) {
            document.getElementById('storagePerProduct').className = 'highlight-green';
        } else {
            document.getElementById('storagePerProduct').className = 'val-blue';
        }

        const postType = document.getElementById('postType').value;
        const logisticsCost = isFbt ? whFeeUSD : ttsUSD; 
        
        let merchPost = 0, custPost = 0, fbtReimburse = 0;
        let forcedPost = false;
        
        const salePrice = getVal('salePrice'); setTxt('salePriceRmb', `â‰ˆ ${formatNum(salePrice*rate)} RMB`);
        const couponVal = getCouponValue(saleQty);
        const orderVal = (salePrice * saleQty) - couponVal;

        if (isFbt && fbtPolicy === 'optOut' && orderVal < 30) {
            custPost = 5.99; merchPost = 0; fbtReimburse = 0.75 * saleQty; forcedPost = true;
        }

        if (!forcedPost) {
            if (postType === 'merchantFree') { merchPost = logisticsCost; custPost = 0; }
            else if (postType === 'customerAll') { merchPost = 0; custPost = logisticsCost; }
            else { custPost = getCustomerPostStep(saleQty); merchPost = logisticsCost - custPost; }
        }

        document.getElementById('postTotalItem').classList.toggle('hide', forcedPost);
        setTxt('postTotalUsd', `${formatNum(logisticsCost)} USD`); setTxt('postTotalRmb', `â‰ˆ ${formatNum(logisticsCost*rate)} RMB`);
        
        document.getElementById('merchantPostItem').classList.toggle('hide', forcedPost);
        setTxt('merchantPostUsd', formatNum(merchPost)); 
        setTxt('merchantPostRmb', `â‰ˆ ${formatNum(merchPost*rate)} RMB`);

        document.getElementById('customerPostItem').classList.toggle('hide', postType === 'merchantFree' && !forcedPost);
        const displayCust = forcedPost ? 5.99 : custPost;
        setTxt('customerPostUsd', formatNum(displayCust)); setTxt('customerPostRmb', `â‰ˆ ${formatNum(displayCust*rate)} RMB`);
        
        document.getElementById('customerPostStepBox').classList.toggle('hide', postType !== 'bothShare' || forcedPost);
        document.getElementById('fbtReimburseItem').classList.toggle('hide', !forcedPost);
        setTxt('fbtReimburse', `${formatNum(fbtReimburse)} USD`);

        for(let i=1; i<=6; i++){
            const cp = getVal('coupon'+i);
            const totP = salePrice * i;
            const valBefore = totP - cp;
            let cPost = 0;
            if (isFbt && fbtPolicy === 'optOut' && valBefore < 30) cPost = 5.99;
            else {
                if(postType === 'bothShare') {
                    cPost = getCustomerPostStep(i);
                } else if(postType === 'customerAll') {
                    if(isFbt) cPost = getFbtUnitRate(getVal('productWeight'), i) * i;
                    else cPost = getTtsFee(getVal('productWeight') * i, document.getElementById('ttsZone').value);
                }
            }
            const finalP = Math.max(0, totP - cp + cPost); 
            const avg = finalP / i;

            let costProd_i = unitCostUSD * i;
            let costFull_i = 0;
            if(isFbt) {
                let fr = getFbtUnitRate(getVal('productWeight'), i);
                let ft = fr * i;
                let sub = (isFbt && fbtPolicy === 'optOut' && valBefore < 30) ? (0.75 * i) : 0;
                costFull_i = ft - sub;
            } else {
                let wh = getVal('localOutFee') + (Math.max(0, i-1) * getVal('localAddOutFee'));
                let tts = getTtsFee(getVal('productWeight') * i, document.getElementById('ttsZone').value);
                costFull_i = wh + tts;
            }
            let fees_i = finalP * ((getVal('commissionRate') + getVal('platformRate') + getVal('damageRate')) / 100);
            let profit_i = finalP - costProd_i - costFull_i - fees_i;
            let profitClass = profit_i > 0 ? 'prof-pos' : 'prof-neg';

            document.getElementById('showItem'+i).innerHTML = 
                `<td>${i}</td><td>${formatNum(totP)}</td><td>${formatNum(cp)}</td><td>${formatNum(cPost)}</td><td>${formatNum(finalP)}</td><td class="hl-val">${formatNum(avg)}</td><td class="${profitClass}">${formatNum(profit_i)}</td>`;
        }

        setTxt('autoCouponText', `${formatNum(couponVal)} USD (ä¹°${saleQty})`);
        setTxt('autoCouponRmb', `â‰ˆ ${formatNum(couponVal*rate)} RMB`);
        
        const revenue = orderVal + displayCust;
        setTxt('finalPriceText', `${formatNum(revenue)} USD`); setTxt('finalPriceRmb', `â‰ˆ ${formatNum(revenue*rate)} RMB`);
        setTxt('avgPrice', `${formatNum(revenue/saleQty)} USD`); setTxt('avgPriceRmb', formatNum((revenue/saleQty)*rate));

        const comm = revenue * (getVal('commissionRate')/100);
        const plat = revenue * (getVal('platformRate')/100);
        const dmg = revenue * (getVal('damageRate')/100);
        const totalFee = comm + plat + dmg;
        setTxt('totalCostUsd', `${formatNum(totalFee)} USD`); setTxt('totalCostRmb', `${formatNum(totalFee*rate)} RMB`);

        const costProd = unitCostUSD * saleQty;
        let costFull = 0;
        if(isFbt) costFull = whFeeUSD - fbtReimburse; 
        else costFull = whFeeUSD + ttsUSD;
        
        const finalCost = costProd + costFull + totalFee;
        const profit = revenue - finalCost;
        const roi = profit > 0 ? (revenue/profit) : 0; 
        
        setTxt('finalAllCostUsd', `${formatNum(finalCost)} USD`); setTxt('finalAllCostRmb', `â‰ˆ ${formatNum(finalCost*rate)} RMB`);
        setTxt('actualIncomeUsd', `${formatNum(revenue)} USD`); setTxt('actualIncomeRmb', `â‰ˆ ${formatNum(revenue*rate)} RMB`);
        
        let platNet = isFbt ? (revenue - whFeeUSD - plat) : (revenue - ttsUSD - plat);
        setTxt('platformNetIncomeUsd', `${formatNum(platNet)} USD`); setTxt('platformNetIncomeRmb', `â‰ˆ ${formatNum(platNet*rate)} RMB`);

        setTxt('finalProfitUsd', `${formatNum(profit)} USD`); setTxt('finalProfitRmb', `â‰ˆ ${formatNum(profit*rate)} RMB`);
        setTxt('profitRate', `${formatNum(revenue>0 ? (profit/revenue)*100 : 0)} %`);
        setTxt('breakEvenRoi', profit>0 ? formatNum(roi) : 'æ— æ³•ä¿æœ¬');

        const pBox = document.getElementById('profitBox');
        if(profit > 0) { 
            pBox.classList.remove('bg-red', 'card-danger-thick');
            pBox.classList.add('bg-green'); 
        } else { 
            pBox.classList.remove('bg-green');
            pBox.classList.add('bg-red', 'card-danger-thick'); 
        }

        // --- å…¨å±€çº¢è‰²è­¦ç¤ºé€»è¾‘ ---
        const normalCards = ['card-base', 'card-ship', 'card-summary', 'card-warehouse', 'card-fees', 'card-pricing'];
        const redDetails = ['details-tts', 'details-fbt', 'details-logic'];
        
        // æ™®é€šå¡ç‰‡å˜çº¢ (ç»†è¾¹æ¡†)
        normalCards.forEach(id => {
            const el = document.getElementById(id);
            if(profit <= 0) el.classList.add('card-danger');
            else el.classList.remove('card-danger');
        });

        // æŠ˜å é¢æ¿å˜çº¢
        redDetails.forEach(id => {
            const el = document.getElementById(id);
            if(profit <= 0) el.classList.add('details-danger');
            else el.classList.remove('details-danger');
        });

        // å¤´éƒ¨æ ‡é¢˜å˜çº¢
        const headerEl = document.getElementById('mainHeader');
        if(profit <= 0) headerEl.classList.add('header-danger');
        else headerEl.classList.remove('header-danger');
    }

    // è®°å½•åˆå§‹æ•°æ®
    function saveToDefaults() {
        document.querySelectorAll('input, select').forEach(el => {
            appDefaults[el.id] = el.value;
        });
    }

    // åˆå§‹åŒ–è¿è¡Œ
    renderRateTables(); // æ¸²æŸ“è¡¨æ ¼
    saveToDefaults(); // é¡µé¢åŠ è½½æ—¶å…ˆä¿å­˜ä¸€æ¬¡HTMLä¸­çš„é»˜è®¤å€¼
    
    // ä¿å­˜åˆå§‹æ•°æ®æŒ‰é’®é€»è¾‘
    document.getElementById('saveInitBtn').addEventListener('click', () => {
        if(confirm('ç¡®å®šå°†å½“å‰é¡µé¢çš„æ‰€æœ‰è¾“å…¥å€¼ä¿å­˜ä¸ºâ€œåˆå§‹æ•°æ®â€å—ï¼Ÿ\nç‚¹å‡»â€œé‡ç½®æ•°æ®â€æŒ‰é’®å°†æ¢å¤åˆ°æ­¤çŠ¶æ€ã€‚')) {
            saveToDefaults();
            alert('âœ… ä¿å­˜æˆåŠŸï¼ç‚¹å‡»â€œé‡ç½®æ•°æ®â€å°†æ¢å¤åˆ°æ­¤çŠ¶æ€ã€‚');
        }
    });

    // é‡ç½®æŒ‰é’®é€»è¾‘
    document.getElementById('resetBtn').addEventListener('click', () => {
        // ä» appDefaults æ¢å¤
        for (const [id, val] of Object.entries(appDefaults)) {
            const el = document.getElementById(id);
            if(el) el.value = val;
        }

        // ç‰¹æ®Šè”åŠ¨é€»è¾‘å¤„ç†
        const storageType = document.getElementById('storageType').value;
        const fbtPolicy = document.getElementById('fbtPolicy').value;
        const postTypeSelect = document.getElementById('postType');
        
        if (storageType === 'fbt' && fbtPolicy === 'optOut') {
            postTypeSelect.disabled = true;
        } else {
            postTypeSelect.disabled = false;
        }

        calculate();
    });
    
    document.getElementById('saveBtn').addEventListener('click', () => {
        const inputs = document.querySelectorAll('input');
        inputs.forEach(input => input.setAttribute('value', input.value));
        const selects = document.querySelectorAll('select');
        selects.forEach(select => {
            const val = select.value;
            const options = select.querySelectorAll('option');
            options.forEach(opt => {
                if(opt.value === val) opt.setAttribute('selected', 'selected');
                else opt.removeAttribute('selected');
            });
        });

        const htmlContent = "<!DOCTYPE html>\n" + document.documentElement.outerHTML;
        const blob = new Blob([htmlContent], {type: 'text/html'});
        const timestamp = new Date().toISOString().replace(/[:.]/g, '-').slice(0, 19);
        const filename = prompt("è¯·è¾“å…¥æ–‡ä»¶å:", "TikTok_Profit_" + timestamp);
        
        if (filename) {
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = filename.endsWith('.html') ? filename : filename + '.html';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }
    });

    const inputs = document.querySelectorAll('input, select');
    inputs.forEach(el => { el.addEventListener('input', calculate); el.addEventListener('change', calculate); });

    calculate();
</script>
</body>
</html>